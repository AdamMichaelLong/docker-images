
##################################### WEB #####################################

redis:
  image: unocha/alpine-redis:latest
  hostname: hrinfo-redis
  container_name: hrinfo-redis
  ports:
    - "10.5.102.31:6379:6379"
  volumes:
    - "/srv/humanitarianresponse.info/var/log/redis:/var/log/redis"

fpm:
  image: unocha/alpine-php-fpm-drupal7-hrinfo:3.4-newrelic
  hostname: hrinfo-fpm
  container_name: hrinfo-fpm
  ports:
    # can't listen to the default port 9000
    # as RW's fpm is listening on all host interfaces
    - "10.5.102.31:9300:9000"
  volumes:
    - "./etc/php5:/etc/php5"
    - "/srv/humanitarianresponse.info/var/log/php:/var/log/php"
    - "/srv/humanitarianresponse.info/var/log/newrelic:/var/log/newrelic"
    # - "/srv/humanitarianresponse.info/www:/srv/www"
    - "/mnt/glusterfs3/www.humanitarianresponse.info/srv/web02/www/html:/srv/www/html"
    - "/mnt/glusterfs3/www.humanitarianresponse.info/files:/srv/www/html/sites/www.humanitarianresponse.info/files"
    - "/mnt/glusterfs3/www.humanitarianresponse.info/private:/srv/www/html/sites/www.humanitarianresponse.info/private"
  environment:
    - TERM=xterm
    - ENVIRONMENT=prod
  extra_hosts:
    # The main (not failover) IP for postgres.
    #- "pgdb-rw: 10.5.201.31"
    - "pgdb-rw: 10.5.68.152"
    # solr - we use version 3 on db02 !!!
    #- "db1: 10.5.201.31"
    - "db2: 10.5.202.31"

nginx:
  image: unocha/alpine-nginx-extras:latest
  hostname: hrinfo-nginx
  container_name: hrinfo-nginx
  ports:
    - "10.5.102.31:80:80"
  volumes:
    - "./etc/nginx:/etc/nginx"
    - "/srv/humanitarianresponse.info/var/lib/nginx:/var/lib/nginx"
    - "/srv/humanitarianresponse.info/var/log/nginx:/var/log/nginx"
    - "/mnt/glusterfs3/www.humanitarianresponse.info/srv/web02/www/html:/srv/www/html"
    - "/mnt/glusterfs3/www.humanitarianresponse.info/files:/srv/www/html/sites/www.humanitarianresponse.info/files"
    - "/mnt/glusterfs3/www.humanitarianresponse.info/private:/srv/www/html/sites/www.humanitarianresponse.info/private"
  environment:
    - TERM=xterm
    - ENVIRONMENT=prod

varnish:
  image: unocha/varnish
  container_name: hrinfo-varnish
  hostname: hrinfo-varnish
  ports:
    # wb01 TEST
    # - "10.5.68.148:8189:80"
    # wb02 LIVE
    - "10.5.68.149:8180:80"
  volumes:
    - "./etc/varnish:/etc/varnish"
    - "/srv/humanitarianresponse.info/vol/log/varnish:/vol/log/varnish"
  environment:
    - STORAGE_BACKEND=malloc,3G

##################################### DB #####################################

solr:
  image: unocha/solr4
  hostname: hrinfo-solr
  container_name: hrinfo-solr
  ports:
  ports:
    # db01
    - "10.5.201.31:8985:8983"
    # db02
    # - "10.5.202.31:8985:8983"
  volumes:
    - "./etc/solr:/opt/solr/example/solr"
    - "./var/lib/solr:/opt/solr/data"
  environment:
    - TERM=xterm
    - ENVIRONMENT=prod

